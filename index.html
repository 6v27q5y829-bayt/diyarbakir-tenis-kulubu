<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Diyarbakƒ±r Tenis Kul√ºb√º</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#065f46">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/33/33736.png">
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&family=Russo+One&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f0fdf4; -webkit-tap-highlight-color: transparent; }
        .font-sport { font-family: 'Russo One', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        /* Tenis kortu temalƒ± arka plan */
        .bg-tennis { 
            background: linear-gradient(to bottom, rgba(6, 78, 59, 0.9), rgba(6, 95, 70, 0.95)), url('https://images.unsplash.com/photo-1627627448839-848e3094c92c?auto=format&fit=crop&w=1000'); 
            background-size: cover; 
            background-attachment: fixed; 
            background-position: center;
        }
        .glass { background: rgba(255,255,255,0.9); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.4); box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .glass-dark { background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); }
        
        #loading-screen { position: fixed; inset: 0; background: #064e3b; display: flex; justify-content: center; align-items: center; color: white; z-index: 9999; flex-direction: column; text-align: center; }
        .loader { width: 48px; height: 48px; border: 5px solid #FFF; border-bottom-color: #84cc16; border-radius: 50%; display: inline-block; box-sizing: border-box; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-tennis min-h-screen text-gray-800">

    <div id="loading-screen">
        <span class="loader mb-4"></span>
        <div class="text-2xl font-bold font-sport text-lime-400">DTK APP</div>
        <div class="text-sm mt-2 opacity-75">Saha Hazƒ±rlanƒ±yor...</div>
    </div>
    <div id="root"></div>

    <script type="text/babel">
        // --- FIREBASE AYARLARI ---
        const firebaseConfig = {
            apiKey: "AIzaSyDaOllootHtCrBEKEILkvq9cXTTNvZJ38Q",
            authDomain: "diyarbakir-tenis.firebaseapp.com",
            projectId: "diyarbakir-tenis",
            storageBucket: "diyarbakir-tenis.firebasestorage.app",
            messagingSenderId: "410226513632",
            appId: "1:410226513632:web:521162e0dcc71e93432285",
            measurementId: "G-LX8YKZL8MY",
            databaseURL: "https://diyarbakir-tenis-default-rtdb.firebaseio.com/"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const { useState, useEffect } = React;

        // --- YARDIMCI FONKSƒ∞YONLAR ---
        // Yerel tarih d√ºzeltmesi (T√ºrkiye saati i√ßin)
        const getLocalDateString = (d = new Date()) => {
            const offset = d.getTimezoneOffset() * 60000;
            const localDate = new Date(d.getTime() - offset);
            return localDate.toISOString().split('T')[0];
        };

        // --- ƒ∞KONLAR ---
        const Icon = ({name, size=20, color="currentColor"}) => {
            const paths = {
                UserSquare: "M3 3h18v18H3z M12 7a3 3 0 1 0 0 6 3 3 0 0 0 0-6z M7 21v-2a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2",
                Lock: "M7 11V7a5 5 0 0 1 10 0v4 M3 11h18v11H3z",
                Calendar: "M3 4h18v18H3z M16 2v4 M8 2v4 M3 10h21",
                Users: "M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2 M23 21v-2a4 4 0 0 0-3-3.87 M16 3.13a4 4 0 0 1 0 7.75",
                LogOut: "M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4 M16 17l5-5-5-5 M21 12H9",
                ChevronLeft: "M15 18l-6-6 6-6",
                Plus: "M12 5v14 M5 12h14",
                Trash2: "M3 6h18 M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6 M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",
                ChartPie: "M21.21 15.89A10 10 0 1 1 8 2.83 M22 12A10 10 0 0 0 12 2v10z",
                Layers: "M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5",
                Check: "M20 6L9 17l-5-5"
            };
            return <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d={paths[name] || ""}/></svg>;
        };

        // --- ANA UYGULAMA ---
        const App = () => {
            // Veri State'leri
            const [groups, setGroups] = useState([]);
            const [coaches, setCoaches] = useState([]);
            const [students, setStudents] = useState([]);
            const [adminPass, setAdminPass] = useState("2121");
            const [dataLoaded, setDataLoaded] = useState(false);

            // UI State'leri
            const [role, setRole] = useState(localStorage.getItem('dtk_role'));
            const [user, setUser] = useState(localStorage.getItem('dtk_user'));
            const [tab, setTab] = useState('schedule');
            const [date, setDate] = useState(getLocalDateString());
            const [loginMode, setLoginMode] = useState(null);
            const [modal, setModal] = useState(null);
            const [inputs, setInputs] = useState({});
            const [activeGroup, setActiveGroup] = useState(null);
            const [confirmModal, setConfirmModal] = useState(null);

            // --- VERƒ∞ √áEKME ---
            useEffect(() => {
                const loadingEl = document.getElementById('loading-screen');
                db.ref('/').on('value', (s) => {
                    const d = s.val() || {};
                    setGroups(d.groups ? Object.values(d.groups) : []);
                    setCoaches(d.coaches ? Object.values(d.coaches) : []);
                    setStudents(d.students ? Object.values(d.students) : []);
                    if(d.adminPass) setAdminPass(d.adminPass);
                    
                    setDataLoaded(true);
                    if(loadingEl) loadingEl.style.display = 'none';
                });
            }, []);

            // --- AUTH FONKSƒ∞YONLARI ---
            const handleLogin = (e) => {
                e.preventDefault();
                if(loginMode === 'admin') {
                    if(inputs.pass === adminPass) {
                        setRole('admin'); 
                        localStorage.setItem('dtk_role', 'admin'); 
                        setLoginMode(null);
                    } else alert("Hatalƒ± ≈ûifre");
                } else {
                    const c = coaches.find(x => x.email === inputs.email);
                    if(c) {
                        if(c.password === inputs.pass || (!c.password && inputs.pass.length > 3)) {
                            // ƒ∞lk giri≈üte ≈üifre olu≈ütur
                            if(!c.password) db.ref(`coaches/${c.id}`).update({password: inputs.pass});
                            
                            setRole('coach'); 
                            setUser(c.name); 
                            localStorage.setItem('dtk_role','coach'); 
                            localStorage.setItem('dtk_user', c.name); 
                            setLoginMode(null);
                        } else alert("≈ûifre Yanlƒ±≈ü");
                    } else alert("Bu e-posta ile kayƒ±tlƒ± antren√∂r bulunamadƒ±.");
                }
            };

            const logout = () => {
                setRole(null);
                setUser(null);
                localStorage.removeItem('dtk_role');
                localStorage.removeItem('dtk_user');
            };

            // --- DATABASE ƒ∞≈ûLEMLERƒ∞ ---
            const saveGroup = () => {
                if(!inputs.name || !inputs.coach) return alert("L√ºtfen grup adƒ± ve hoca se√ßin");
                const id = Date.now();
                const newGroup = { 
                    id, 
                    name: inputs.name, 
                    instructor: inputs.coach, 
                    schedule: [{day: inputs.day || 'Cumartesi', time: inputs.time || '10:00'}], 
                    players: [] 
                };
                db.ref(`groups/${id}`).set(newGroup);
                setModal(null);
            };

            const saveCoach = () => {
                if(!inputs.name || !inputs.email) return alert("Bilgileri eksiksiz girin");
                const id = Date.now();
                db.ref(`coaches/${id}`).set({ id, name: inputs.name, email: inputs.email, password: null });
                setModal(null);
            };

            const saveStudent = () => {
                if(!inputs.name) return alert("ƒ∞sim girin");
                const id = Date.now();
                const s = { id, name: inputs.name, phone: inputs.phone || "", age: inputs.age || "" };
                
                // √ñƒürenciyi ana listeye ekle
                db.ref(`students/${id}`).set(s);
                
                // Eƒüer bir grup se√ßildiyse oraya da ekle
                if(inputs.targetGroup) {
                    const g = groups.find(x => x.id == inputs.targetGroup);
                    if(g) {
                        const currentPlayers = g.players || [];
                        db.ref(`groups/${g.id}`).update({ players: [...currentPlayers, s] });
                    }
                }
                setModal(null);
            };

            const toggleAttendance = (gid, pid, status) => {
                // Not: activeGroup state'i ile DB senkronize olmalƒ±
                const g = groups.find(x => x.id === gid);
                if (!g) return;
                
                const currentStatus = g.records?.[date]?.[pid];
                const newVal = currentStatus === status ? null : status; // Tƒ±klanƒ±nca kaldƒ±r veya deƒüi≈ütir
                
                if(newVal === null) db.ref(`groups/${gid}/records/${date}/${pid}`).remove();
                else db.ref(`groups/${gid}/records/${date}/${pid}`).set(newVal);
            };

            const askConfirm = (msg, cb) => setConfirmModal({msg, cb});

            // --- RENDER HELPERS ---
            const days = ['Pazar','Pazartesi','Salƒ±','√áar≈üamba','Per≈üembe','Cuma','Cumartesi'];
            const curDayName = days[new Date(date).getDay()];
            const dailyGroups = groups.filter(g => g.schedule?.some(s => s.day === curDayName));

            // --- EKRANLAR ---
            
            // 1. Gƒ∞Rƒ∞≈û EKRANI
            if(!role) return (
                <div className="min-h-screen flex flex-col items-center justify-center p-6 text-center relative z-10">
                    <div className="glass p-8 rounded-[40px] w-full max-w-sm shadow-2xl border border-white/50">
                        <img src="https://cdn-icons-png.flaticon.com/512/33/33736.png" className="w-24 h-24 mx-auto mb-4 drop-shadow-lg animate-bounce"/>
                        <h1 className="text-3xl font-sport text-white drop-shadow-md mb-1">Diyarbakƒ±r</h1>
                        <h2 className="text-xl font-sport text-lime-400 drop-shadow-md mb-8">TENƒ∞S KUL√úB√ú</h2>
                        
                        <div className="space-y-3">
                            <button onClick={()=>{setLoginMode('coach'); setInputs({})}} className="w-full bg-lime-500 hover:bg-lime-400 transition py-4 rounded-2xl font-bold text-emerald-900 flex items-center justify-center gap-2 shadow-lg">
                                <Icon name="UserSquare"/> ANTREN√ñR Gƒ∞Rƒ∞≈ûƒ∞
                            </button>
                            <button onClick={()=>{setLoginMode('admin'); setInputs({})}} className="w-full bg-white/20 hover:bg-white/30 backdrop-blur-sm border border-white/40 py-4 rounded-2xl font-bold text-white flex items-center justify-center gap-2 shadow-lg">
                                <Icon name="Lock"/> Y√ñNETƒ∞Cƒ∞ Gƒ∞Rƒ∞≈ûƒ∞
                            </button>
                        </div>
                        <p className="mt-8 text-white/60 text-[10px] tracking-widest">DTK v8.0 ‚Ä¢ ONLINE</p>
                    </div>

                    {/* Giri≈ü Modalƒ± */}
                    {loginMode && (
                        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-3xl p-6 w-full max-w-sm relative animate-pulse-once">
                                <button onClick={()=>setLoginMode(null)} className="absolute top-4 right-4 w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 text-gray-500 font-bold">‚úï</button>
                                <h3 className="text-xl font-bold mb-1 text-emerald-800">{loginMode==='admin'?'Y√∂netici':'Antren√∂r'}</h3>
                                <p className="text-sm text-gray-400 mb-6">L√ºtfen giri≈ü bilgilerinizi giriniz.</p>
                                <form onSubmit={handleLogin} className="space-y-4">
                                    {loginMode==='coach' && (
                                        <input type="email" placeholder="E-posta Adresi" className="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition" onChange={e=>setInputs({...inputs, email:e.target.value})} />
                                    )}
                                    <input type="password" placeholder="≈ûifre" className="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition" onChange={e=>setInputs({...inputs, pass:e.target.value})} />
                                    <button className="w-full bg-emerald-700 text-white p-4 rounded-xl font-bold shadow-lg hover:bg-emerald-800 transition">Giri≈ü Yap</button>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );

            // Veri y√ºklenmediyse bekle
            if (!dataLoaded) return null;

            // 2. ANA DASHBOARD
            return (
                <div className="min-h-screen flex flex-col relative z-0">
                    {/* √úst Bar */}
                    <div className="p-4 pt-safe-top bg-emerald-900/95 text-white flex justify-between items-center shadow-lg backdrop-blur-md sticky top-0 z-40">
                        <div className="flex items-center gap-3">
                            {activeGroup ? (
                                <button onClick={()=>setActiveGroup(null)} className="bg-white/10 p-2 rounded-full"><Icon name="ChevronLeft"/></button>
                            ) : (
                                <img src="https://cdn-icons-png.flaticon.com/512/33/33736.png" className="w-10 h-10 rounded-full bg-white p-1 object-cover"/>
                            )}
                            <div>
                                <div className="font-sport text-lg tracking-wide leading-tight">{activeGroup ? activeGroup.name : "KUL√úP Y√ñNETƒ∞Mƒ∞"}</div>
                                <div className="text-[10px] text-emerald-300 font-bold tracking-wider uppercase">{role==='admin' ? 'Y√ñNETƒ∞Cƒ∞ MODU' : user}</div>
                            </div>
                        </div>
                        <button onClick={logout} className="bg-red-500/20 p-2 rounded-lg text-red-200 hover:bg-red-500 hover:text-white transition"><Icon name="LogOut"/></button>
                    </div>

                    {/* ƒ∞√ßerik Alanƒ± */}
                    <div className="flex-1 overflow-y-auto p-4 pb-32 no-scrollbar">
                        
                        {/* GRUP DETAY SAYFASI (YOKLAMA) */}
                        {activeGroup ? (
                            <div className="animate-fade-in">
                                <div className="glass p-4 rounded-3xl mb-4 flex justify-between items-center">
                                    <div>
                                        <h2 className="text-sm text-gray-500 font-bold uppercase">Antren√∂r</h2>
                                        <div className="text-xl font-bold text-emerald-900">{activeGroup.instructor}</div>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-3xl font-sport text-emerald-600">{activeGroup.schedule?.[0]?.time}</div>
                                        <div className="text-xs text-gray-500 font-bold uppercase">{curDayName}</div>
                                    </div>
                                </div>

                                {/* Hƒ±zlƒ± √ñƒürenci Ekleme (Sadece Admin veya Grubun Hocasƒ±) */}
                                {(role === 'admin' || user === activeGroup.instructor) && (
                                    <div className="flex gap-2 mb-6">
                                        <input 
                                            placeholder="Misafir Oyuncu Ekle..." 
                                            className="flex-1 p-3 rounded-2xl border-none shadow-inner bg-white/80 focus:ring-2 focus:ring-emerald-500 outline-none" 
                                            value={inputs.quickName||''} 
                                            onChange={e=>setInputs({...inputs, quickName:e.target.value})}
                                        />
                                        <button 
                                            onClick={()=>{
                                                if(!inputs.quickName) return; 
                                                const id=Date.now(); 
                                                const s={id, name:inputs.quickName}; 
                                                // Gruba ekle
                                                const currentPlayers = activeGroup.players || [];
                                                db.ref(`groups/${activeGroup.id}`).update({players:[...currentPlayers, s]}); 
                                                // State g√ºncelle (anlƒ±k g√∂r√ºnmesi i√ßin)
                                                setActiveGroup({...activeGroup, players: [...currentPlayers, s]});
                                                setInputs({...inputs, quickName:''});
                                            }} 
                                            className="bg-emerald-600 text-white w-12 rounded-2xl font-bold shadow-lg flex items-center justify-center text-xl"
                                        >
                                            +
                                        </button>
                                    </div>
                                )}

                                {/* Oyuncu Listesi */}
                                <div className="space-y-3">
                                    {(activeGroup.players || []).length === 0 && <div className="text-center text-white/70 py-10">Bu grupta hen√ºz oyuncu yok.</div>}
                                    
                                    {(activeGroup.players || []).map(p => { 
                                        // Bu oyuncunun bug√ºnk√º durumu
                                        // Ger√ßek veriyi groups ana state'inden okuyalƒ±m ki senkron olsun
                                        const realGroupData = groups.find(g => g.id === activeGroup.id);
                                        const status = realGroupData?.records?.[date]?.[p.id];
                                        
                                        return (
                                            <div key={p.id} className="glass p-3 rounded-2xl flex justify-between items-center shadow-sm border-l-4 border-transparent hover:border-emerald-500 transition">
                                                <div className="flex items-center gap-3">
                                                    <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold transition-colors ${status==='present'?'bg-lime-500 shadow-lime-500/50 shadow-lg':status==='absent'?'bg-red-500 shadow-red-500/50 shadow-lg':'bg-gray-200 text-gray-400'}`}>
                                                        {status === 'present' ? '‚úì' : status === 'absent' ? '‚úï' : '?'}
                                                    </div>
                                                    <div>
                                                        <span className="font-bold text-gray-800 block">{p.name}</span>
                                                        <span className="text-[10px] text-gray-500 uppercase font-bold tracking-wider">{status === 'present' ? 'DERSTE' : status === 'absent' ? 'GELMEDƒ∞' : 'BEKLƒ∞YOR'}</span>
                                                    </div>
                                                </div>
                                                
                                                {(role === 'admin' || user === activeGroup.instructor) && (
                                                    <div className="flex gap-1">
                                                        <button onClick={()=>toggleAttendance(activeGroup.id, p.id, 'present')} className={`w-10 h-10 rounded-xl flex items-center justify-center border ${status==='present' ? 'bg-lime-100 border-lime-500 text-lime-600' : 'bg-white border-gray-200 text-gray-300'}`}>‚úì</button>
                                                        <button onClick={()=>toggleAttendance(activeGroup.id, p.id, 'absent')} className={`w-10 h-10 rounded-xl flex items-center justify-center border ${status==='absent' ? 'bg-red-100 border-red-500 text-red-600' : 'bg-white border-gray-200 text-gray-300'}`}>‚úï</button>
                                                        {role==='admin' && (
                                                            <button onClick={()=>{
                                                                if(confirm(`${p.name} gruptan √ßƒ±karƒ±lsƒ±n mƒ±?`)){
                                                                    const np = activeGroup.players.filter(x=>x.id!==p.id); 
                                                                    db.ref(`groups/${activeGroup.id}`).update({players:np}); 
                                                                    setActiveGroup({...activeGroup, players:np});
                                                                }
                                                            }} className="w-10 h-10 rounded-xl flex items-center justify-center bg-red-50 text-red-400 border border-red-100 ml-2"><Icon name="Trash2" size={16}/></button>
                                                        )}
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        ) : (
                            /* ANA Lƒ∞STELER */
                            <>
                                {/* Tarih Se√ßici */}
                                {tab !== 'reports' && (
                                    <div className="flex gap-2 overflow-x-auto pb-4 mb-2 no-scrollbar snap-x">
                                        {[-1,0,1,2,3,4,5].map(i => { 
                                            const d = new Date(); 
                                            d.setDate(d.getDate() + i); 
                                            // Yerel tarih stringi olu≈ütur
                                            const offset = d.getTimezoneOffset() * 60000;
                                            const ds = new Date(d.getTime() - offset).toISOString().split('T')[0];
                                            
                                            const isSelected = ds === date;
                                            return (
                                                <button key={i} onClick={()=>setDate(ds)} className={`snap-center flex-shrink-0 p-3 rounded-2xl min-w-[64px] text-center border transition-all duration-300 ${isSelected ? 'bg-lime-500 border-lime-600 text-white shadow-lg scale-105' : 'glass text-gray-600 border-white/40'}`}>
                                                    <div className={`text-[10px] uppercase font-bold ${isSelected?'text-lime-100':'text-gray-400'}`}>{['Pa','Pt','Sa','√áa','Pe','Cu','Ct'][d.getDay()]}</div>
                                                    <div className="text-xl font-black font-sport">{d.getDate()}</div>
                                                </button> 
                                            )
                                        })}
                                    </div>
                                )}
                                
                                <div className="space-y-4 pb-20">
                                    {/* PROGRAM SEKMESƒ∞ */}
                                    {tab === 'schedule' && (
                                        <>
                                            {dailyGroups.length === 0 && (
                                                <div className="text-center py-10 glass rounded-3xl">
                                                    <div className="text-4xl mb-2">üéæ</div>
                                                    <div className="text-gray-500 font-bold">Bug√ºn ders yok.</div>
                                                    <div className="text-xs text-gray-400">ƒ∞yi dinlenmeler!</div>
                                                </div>
                                            )}
                                            {dailyGroups.map(g => (
                                                <div key={g.id} onClick={()=>setActiveGroup(g)} className="glass p-5 rounded-3xl relative shadow-sm active:scale-95 transition-transform group cursor-pointer hover:bg-white/90">
                                                    <div className="absolute top-0 right-0 bg-emerald-100 text-emerald-800 px-4 py-2 rounded-bl-2xl rounded-tr-2xl text-sm font-black font-sport">
                                                        {g.schedule?.find(s=>s.day===curDayName)?.time}
                                                    </div>
                                                    <h3 className="text-lg font-black text-gray-800 font-sport mb-1">{g.name}</h3>
                                                    <div className="flex items-center gap-2">
                                                        <div className="bg-emerald-500 text-white text-[10px] px-2 py-0.5 rounded-md font-bold uppercase">{g.instructor}</div>
                                                        <div className="text-xs text-gray-500 font-bold">‚Ä¢ {g.players?.length||0} Oyuncu</div>
                                                    </div>
                                                </div>
                                            ))}
                                        </>
                                    )}

                                    {/* GRUPLAR SEKMESƒ∞ */}
                                    {tab === 'groups' && groups.map(g => (
                                        <div key={g.id} className="glass p-4 rounded-2xl flex justify-between items-center">
                                            <div>
                                                <b className="text-emerald-900">{g.name}</b>
                                                <div className="text-xs text-gray-500">{g.instructor} ‚Ä¢ {g.schedule?.[0]?.day} {g.schedule?.[0]?.time}</div>
                                            </div>
                                            {role==='admin' && <button onClick={()=>askConfirm(`${g.name} silinsin mi?`, ()=>db.ref(`groups/${g.id}`).remove())} className="bg-red-50 p-2 rounded-lg text-red-500"><Icon name="Trash2"/></button>}
                                        </div>
                                    ))}

                                    {/* HOCALAR SEKMESƒ∞ */}
                                    {tab === 'coaches' && coaches.map(c => (
                                        <div key={c.id} className="glass p-4 rounded-2xl flex justify-between items-center">
                                            <div className="flex items-center gap-3">
                                                <div className="w-10 h-10 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center font-bold text-lg">{c.name.charAt(0)}</div>
                                                <div>
                                                    <b className="block text-gray-800">{c.name}</b>
                                                    <div className="text-xs text-gray-500">{c.email}</div>
                                                </div>
                                            </div>
                                            {role==='admin' && <button onClick={()=>askConfirm('Sil?', ()=>db.ref(`coaches/${c.id}`).remove())} className="text-red-400 bg-red-50 p-2 rounded-lg"><Icon name="Trash2"/></button>}
                                        </div>
                                    ))}

                                    {/* √ñƒûRENCƒ∞LER SEKMESƒ∞ */}
                                    {tab === 'students' && (
                                        <>
                                            <div className="glass p-2 rounded-xl mb-2 flex gap-2">
                                                <input placeholder="√ñƒürenci Ara..." className="w-full bg-transparent p-2 outline-none text-sm" onChange={(e)=>{/* Arama eklenebilir */}} />
                                                <button className="text-gray-400"><Icon name="Users"/></button>
                                            </div>
                                            {students.map(s => (
                                                <div key={s.id} className="glass p-4 rounded-2xl flex justify-between items-center mb-2">
                                                    <b>{s.name}</b>
                                                    {role==='admin' && <button onClick={()=>askConfirm('Sil?', ()=>db.ref(`students/${s.id}`).remove())} className="text-red-400 bg-red-50 p-2 rounded-lg"><Icon name="Trash2"/></button>}
                                                </div>
                                            ))}
                                        </>
                                    )}
                                    
                                    {/* RAPORLAR SEKMESƒ∞ */}
                                    {tab === 'reports' && (
                                        <div className="space-y-4">
                                            <div className="glass p-6 rounded-3xl border-l-8 border-lime-400 shadow-lg">
                                                <div>
                                                    <div className="text-xs font-bold text-gray-500 uppercase tracking-widest mb-1">BU AY YAPILAN DERS</div>
                                                    <div className="text-5xl font-black font-sport text-emerald-900">
                                                        {(() => { 
                                                            const m=new Date().getMonth(); 
                                                            let c=0; 
                                                            groups.forEach(g=>{
                                                                if(g.records) Object.keys(g.records).forEach(d=>{if(new Date(d).getMonth()===m) c++})
                                                            }); 
                                                            return c; 
                                                        })()}
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="glass p-5 rounded-3xl">
                                                <h3 className="font-bold mb-4 text-emerald-800 flex items-center gap-2"><Icon name="ChartPie"/> EN ƒ∞STƒ∞KRARLI OYUNCULAR</h3>
                                                {(() => {
                                                    const l=[]; 
                                                    students.forEach(s=>{
                                                        let p=0; 
                                                        groups.forEach(g=>{
                                                            if(g.players?.some(x=>x.id===s.id) && g.records) 
                                                                Object.values(g.records).forEach(r=>{if(r[s.id]==='present') p++})
                                                        }); 
                                                        if(p>0) l.push({...s, p})
                                                    });
                                                    if(l.length === 0) return <div className="text-sm text-gray-400">Hen√ºz veri yok.</div>;
                                                    return l.sort((a,b)=>b.p-a.p).slice(0,5).map((s,i)=> (
                                                        <div key={i} className="flex justify-between items-center py-3 border-b border-gray-100 last:border-0">
                                                            <div className="flex items-center gap-3">
                                                                <div className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${i===0?'bg-yellow-400 text-yellow-900':i===1?'bg-gray-300 text-gray-700':i===2?'bg-orange-300 text-orange-800':'bg-emerald-100 text-emerald-600'}`}>{i+1}</div>
                                                                <span className="font-semibold text-gray-700">{s.name}</span>
                                                            </div>
                                                            <span className="font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded-lg text-xs">{s.p} Ders</span>
                                                        </div>
                                                    ));
                                                })()}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </>
                        )}
                    </div>

                    {/* Alt Navigasyon ve FAB Butonlarƒ± */}
                    {!activeGroup && (
                        <>
                            {role==='admin' && (
                                <div className="fixed bottom-24 right-4 flex flex-col gap-3 z-50">
                                    {tab === 'groups' && <button onClick={()=>{setModal('group'); setInputs({day:'Cumartesi', time:'10:00'})}} className="bg-lime-500 hover:bg-lime-400 text-emerald-900 w-14 h-14 rounded-2xl shadow-xl shadow-lime-500/40 text-3xl flex items-center justify-center border-2 border-white/20 transition-transform hover:scale-110 font-bold">+</button>}
                                    {tab === 'students' && <button onClick={()=>{setModal('student'); setInputs({})}} className="bg-emerald-600 hover:bg-emerald-500 text-white w-14 h-14 rounded-2xl shadow-xl shadow-emerald-600/40 text-3xl flex items-center justify-center border-2 border-white/20 transition-transform hover:scale-110 font-bold">+</button>}
                                    {tab === 'coaches' && <button onClick={()=>{setModal('coach'); setInputs({})}} className="bg-orange-500 hover:bg-orange-400 text-white w-14 h-14 rounded-2xl shadow-xl shadow-orange-500/40 text-3xl flex items-center justify-center border-2 border-white/20 transition-transform hover:scale-110 font-bold">+</button>}
                                </div>
                            )}
                            
                            <div className="fixed bottom-6 left-6 right-6 glass-dark rounded-[24px] p-2 flex justify-between shadow-2xl backdrop-blur-xl z-50 border border-white/10">
                                <button onClick={()=>setTab('schedule')} className={`p-2 flex-1 flex flex-col items-center transition-all ${tab==='schedule'?'text-lime-400 scale-110':'text-gray-400 hover:text-white'}`}><Icon name="Calendar"/><span className="text-[9px] mt-1 font-bold">Program</span></button>
                                <button onClick={()=>setTab('groups')} className={`p-2 flex-1 flex flex-col items-center transition-all ${tab==='groups'?'text-lime-400 scale-110':'text-gray-400 hover:text-white'}`}><Icon name="Layers"/><span className="text-[9px] mt-1 font-bold">Gruplar</span></button>
                                <button onClick={()=>setTab('students')} className={`p-2 flex-1 flex flex-col items-center transition-all ${tab==='students'?'text-lime-400 scale-110':'text-gray-400 hover:text-white'}`}><Icon name="Users"/><span className="text-[9px] mt-1 font-bold">√ñƒürenci</span></button>
                                <button onClick={()=>setTab('coaches')} className={`p-2 flex-1 flex flex-col items-center transition-all ${tab==='coaches'?'text-lime-400 scale-110':'text-gray-400 hover:text-white'}`}><Icon name="UserSquare"/><span className="text-[9px] mt-1 font-bold">Hoca</span></button>
                                <button onClick={()=>setTab('reports')} className={`p-2 flex-1 flex flex-col items-center transition-all ${tab==='reports'?'text-lime-400 scale-110':'text-gray-400 hover:text-white'}`}><Icon name="ChartPie"/><span className="text-[9px] mt-1 font-bold">Rapor</span></button>
                            </div>
                        </>
                    )}

                    {/* MODALLER (Popup Pencereleri) */}
                    {modal && (
                        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[60] p-4">
                            <div className="bg-white rounded-[32px] p-6 w-full max-w-sm relative shadow-2xl animate-fade-in-up">
                                <button onClick={()=>setModal(null)} className="absolute top-4 right-4 font-bold text-gray-300 hover:text-gray-500 p-2">‚úï</button>
                                <h3 className="text-xl font-bold mb-6 text-emerald-900 border-b pb-2">{modal==='group'?'Yeni Grup':modal==='coach'?'Yeni Antren√∂r':'Yeni √ñƒürenci'}</h3>
                                
                                <div className="space-y-4">
                                    {modal==='group' && (
                                        <>
                                            <input placeholder="Grup Adƒ± (√ñrn: Junior A)" className="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl outline-none focus:border-emerald-500 transition" onChange={e=>setInputs({...inputs, name:e.target.value})}/>
                                            <select className="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl outline-none focus:border-emerald-500 transition appearance-none" onChange={e=>setInputs({...inputs, coach:e.target.value})}>
                                                <option>Antren√∂r Se√ßiniz</option>
                                                {coaches.map(c=><option key={c.id} value={c.name}>{c.name}</option>)}
                                            </select>
                                            <div className="flex gap-2">
                                                <select className="bg-gray-50 border border-gray-200 p-4 rounded-xl flex-1 outline-none" onChange={e=>setInputs({...inputs, day:e.target.value})}>
                                                    {days.map(d=><option key={d} value={d}>{d}</option>)}
                                                </select>
                                                <select className="bg-gray-50 border border-gray-200 p-4 rounded-xl flex-1 outline-none" onChange={e=>setInputs({...inputs, time:e.target.value})}>
                                                    <option>09:00</option><option>10:00</option><option>11:00</option><option>12:00</option><option>13:00</option><option>14:00</option><option>15:00</option><option>16:00</option><option>17:00</option><option>18:00</option><option>19:00</option><option>20:00</option>
                                                </select>
                                            </div>
                                            <button onClick={saveGroup} className="w-full bg-emerald-600 text-white p-4 rounded-xl font-bold shadow-lg mt-2">Kaydet</button>
                                        </>
                                    )} 
                                    
                                    {modal==='coach' && (
                                        <>
                                            <input placeholder="Ad Soyad" className="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl outline-none focus:border-emerald-500 transition" onChange={e=>setInputs({...inputs, name:e.target.value})}/>
                                            <input placeholder="E-posta" className="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl outline-none focus:border-emerald-500 transition" onChange={e=>setInputs({...inputs, email:e.target.value})}/>
                                            <button onClick={saveCoach} className="w-full bg-orange-500 text-white p-4 rounded-xl font-bold shadow-lg mt-2">Kaydet</button>
                                        </>
                                    )} 
                                    
                                    {modal==='student' && (
                                        <>
                                            <input placeholder="Ad Soyad" className="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl outline-none focus:border-emerald-500 transition" onChange={e=>setInputs({...inputs, name:e.target.value})}/>
                                            <input placeholder="Telefon (ƒ∞steƒüe baƒülƒ±)" className="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl outline-none focus:border-emerald-500 transition" onChange={e=>setInputs({...inputs, phone:e.target.value})}/>
                                            <select className="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl outline-none focus:border-emerald-500 transition" onChange={e=>setInputs({...inputs, targetGroup:e.target.value})}>
                                                <option value="">Bir Gruba Ekle (ƒ∞steƒüe baƒülƒ±)</option>
                                                {groups.map(g=><option key={g.id} value={g.id}>{g.name} ({g.instructor})</option>)}
                                            </select>
                                            <button onClick={saveStudent} className="w-full bg-emerald-600 text-white p-4 rounded-xl font-bold shadow-lg mt-2">Kaydet</button>
                                        </>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* ONAY PENCERESƒ∞ */}
                    {confirmModal && (
                        <div className="fixed inset-0 bg-black/60 flex items-center justify-center z-[70] backdrop-blur-sm p-4">
                            <div className="bg-white p-6 rounded-3xl w-full max-w-xs text-center shadow-2xl animate-bounce-short">
                                <div className="text-red-500 text-4xl mb-2">‚ö†Ô∏è</div>
                                <h3 className="font-bold text-gray-800 text-lg mb-6">{confirmModal.msg}</h3>
                                <div className="flex gap-3">
                                    <button onClick={()=>{confirmModal.cb(); setConfirmModal(null)}} className="flex-1 bg-red-500 text-white p-3 rounded-xl font-bold shadow-md">Evet, Sil</button>
                                    <button onClick={()=>setConfirmModal(null)} className="flex-1 bg-gray-100 text-gray-700 p-3 rounded-xl font-bold">Vazge√ß</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>